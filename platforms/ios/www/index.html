<!DOCTYPE html>
<html >

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!--<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />-->
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' ; style-src * 'unsafe-inline'  ; media-src *  ; img-src 'self' data:  "/>
    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="js/angular.min.js"></script>
    <script type="text/javascript" src="js/angular-route.min.js"></script>
    <base href="." />
    <title>Ngā Taonga O Ngāti Toa</title>
</head>

<body id="appBody" ng-controller="home_controller" ng-strict-di>
<!--
These are the templates that will be injected into the <ng-view> region below. They are referenced by id by the
routeProvider in the controller defined in the accompanying javascript file
-->
<script type="text/ng-template" id="home.html">
    <ul class="menu"><li ng-repeat="x in menuitems.mainmenu" ng-click = "goTo(x.url)" class="menuitem">{{ x.name }}</li></ul>
</script>

<script type="text/ng-template" id="karakia.html">
    <ul class="menu"><li ng-repeat="x in menuitems.karakia" ng-click = "goTo(x.url)" class="menuitem">{{ x.name }}</li></ul>
</script>

<script type="text/ng-template" id="moteatea.html">
    <ul class="menu"><li ng-repeat="x in menuitems.moteatea" ng-click = "goTo(x.url)" class="menuitem">{{ x.name }}</li></ul>
</script>
<script type="text/ng-template" id="haka.html">
    <ul class="menu"><li ng-repeat="x in menuitems.haka" ng-click = "goTo(x.url)" class="menuitem">{{ x.name }}</li></ul>
</script>

<script type="text/ng-template" id="waiata.html">
    <ul class="menu"><li ng-repeat="x in menuitems.waiata" ng-click = "goTo(x.url)" class="menuitem">{{ x.name }}</li></ul>
</script>
<script type="text/ng-template" id="whakatauki.html">
    <ul class="menu"><li ng-repeat="x in menuitems.whakatauki" ng-click = "goTo(x.url)" class="menuitem">{{ x.name }}</li></ul>
</script>

<script type="text/ng-template" id="pepeha.html">
    <ul class="menu"><li ng-repeat="x in menuitems.pepeha" ng-click = "goTo(x.url)" class="menuitem">{{ x.name }}</li></ul>
</script>

<!--
***** menu templates finished *****
-->
    <header>
        <img id="header_image" src="img/logo-kapiti.png">
    </header>

<div id="content_panel"><ng-view class="content_child"></ng-view></div>

<audio id="hidden_player" autoplay="true" ></audio>
<!--<p class="event listening">Connecting to Device</p>-->
    <footer>
        <audio controls style="width:100%;display: none;" type="audio/mp3" id="player1">
        </audio>
        <audio controls style="width:100%;display: none;" type="audio/mp3" id="player2">
        </audio>
        <div class="navigation_bar background" style="display:none;">
            <img class="navigation_entry" id="navigate_home" src="img/icon/home.png">
            <img class="navigation_entry" id="navigate_back" src="img/icon/back.png">
            <img class="navigation_entry player_control" id="player_all" style="display:none;" src="img/icon/all.png">
            <img class="navigation_entry player_control" id="player_none" style="display:none;" src="img/icon/none.png">
            <img class="navigation_entry player_control" id="font_larger" style="display:none;" src="img/icon/font_larger.png">
            <img  class="navigation_entry player_control" id="font_smaller" style="display:none;" src="img/icon/font_smaller.png">
            <img class="navigation_entry player_control" id="player_help" style="display:none;" ng-click="goTo('/p_help.html')" src="img/icon/help.png">


        </div>
    </footer>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
        $("#navigate_home").click(function() {
            window.location.href = 'index.html' ;
        }) ;
        var last_header_click = 0;
        $('#header_image').click(function() {
            var this_click = new Date().getTime() ;
            if(this_click - last_header_click < 400) {
                console.log('Double click detected') ;
                navigator.notification.confirm("Would you like to reset all warnings and help prompts?",
                function(buttonIndex) {
                    console.log('Index of pressed button: ' + buttonIndex) ;
                 if(buttonIndex = 1) {
                    console.log("Warnings and help reset confirmed") ;
                    console.log('Home double clicked. Prompting to remove flags from local storage') ;
                    var app_flags = [ "player_help", "home_help", "other_help" ] ;
                    $.each(app_flags, function(index, value) {
                        console.log('Flag ' + index + ", value " + value) ;
                        if(window.localStorage.getItem(value)) {
                            window.localStorage.removeItem(value) ;
                        }
                    }) ;
                }
                else {
                    console.log("Reset warnings and help cancelled") ;
                }
                }, 'Reset Warnings?',
                    ['OK','Cancel']
                ) ;
            }
            else {
                last_header_click = this_click ;
            }
        });
        $("#navigate_back").click(function() {
            window.location.href = 'javascript: window.history.back() ' ;
        });

    </script>

</body>

</html>